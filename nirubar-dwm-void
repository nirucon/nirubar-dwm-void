#!/bin/sh

# Simple script to display date and time with xsetroot by Nicklas Rudolfsson
# https://github.com/nirucon

# Function to check if Font Awesome is installed
check_font_awesome() {
    fc-list | grep -q -i "Font Awesome"
}

# Set identifier based on font availability
IDENTIFIER=$(check_font_awesome && echo "fontawesome" || echo "text")

# Check if the device is a laptop
IS_LAPTOP=$(ls /sys/class/power_supply | grep -q 'BAT' && echo true || echo false)

# Check if WiFi card is available
HAS_WIFI=$(nmcli device status | grep -q wifi && echo true || echo false)

# Function to get RAM usage
get_ram_usage() {
    RAM=$(free -h | awk '/^Mem:/ {print $3 "/" $2}')
    if [ "$IDENTIFIER" = "fontawesome" ]; then
        echo " $RAM"
    else
        echo "mem: $RAM"
    fi
}

# Function to get disk usage for the root filesystem
get_disk_usage() {
    DISK=$(df -h / | awk 'END{print $3 "/" $2}')
    if [ "$IDENTIFIER" = "fontawesome" ]; then
        echo " $DISK"
    else
        echo "disk: $DISK"
    fi
}

# Function to get the current date and time
get_datetime() {
    date "+%Y-%m-%d %H:%M"
}

# Function to get battery status
get_battery_status() {
    BATTERY_STATUS=""
    for battery in /sys/class/power_supply/BAT*; do
        [ -d "$battery" ] || continue
        CHARGE=$(cat "$battery/capacity")
        STATUS=$(cat "$battery/status")
        BAT_NAME=$(basename "$battery")
        if [ "$IDENTIFIER" = "fontawesome" ]; then
            ICON=$(case $CHARGE in
                       [8-9][0-9]|100) echo "";;
                       [6-7][0-9]) echo "";;
                       [4-5][0-9]) echo "";;
                       [2-3][0-9]) echo "";;
                       *) echo "";;
                   esac)
            [ "$STATUS" = "Charging" ] && ICON="$ICON "
            BATTERY_STATUS+="$ICON $CHARGE% "
        else
            if [ "$STATUS" = "Charging" ]; then
                ICON="bat: $CHARGE% (charging)"
            else
                ICON="bat: $CHARGE%"
            fi
            BATTERY_STATUS+="$BAT_NAME: $ICON "
        fi
    done
    echo "$BATTERY_STATUS"
}

# Function to get WiFi status
get_wifi_status() {
    if [ "$HAS_WIFI" = true ]; then
        CONNAME=$(nmcli -t -f active,ssid dev wifi | grep '^yes' | cut -d: -f2)
        if [ -z "$CONNAME" ]; then
            if [ "$IDENTIFIER" = "fontawesome" ]; then
                echo " Disconnected"
            else
                echo "wifi: disconnected"
            fi
        else
            if [ "$IDENTIFIER" = "fontawesome" ]; then
                echo " $CONNAME"
            else
                echo "wifi: $CONNAME"
            fi
        fi
    else
       

